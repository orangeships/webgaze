# é«˜æ•ˆè·å–æœ€ä¸Šå±‚åº”ç”¨æŒ‡å®šåŒºåŸŸå†…UIæ§ä»¶ä¿¡æ¯çš„æ–¹æ³•

è¦é«˜æ•ˆè·å–æœ€ä¸Šå±‚åº”ç”¨æŒ‡å®šå°åŒºåŸŸï¼ˆå¦‚150Ã—150åƒç´ ï¼‰å†…çš„UIæ§ä»¶ä¿¡æ¯ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¼˜åŒ–æ–¹æ³•ï¼Œé¿å…æ‰«ææ•´ä¸ªçª—å£ï¼š

## ğŸ¯ æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥

```python
from pywinauto import Application
import pywinauto.findwindows as findwindows
import time

def get_controls_in_region(region_center_x, region_center_y, region_width=150, region_height=150):
    """
    é«˜æ•ˆè·å–æŒ‡å®šå±å¹•åŒºåŸŸå†…çš„UIæ§ä»¶ä¿¡æ¯
    region_center_x, region_center_y: åŒºåŸŸä¸­å¿ƒç‚¹å±å¹•åæ ‡
    region_width, region_height: åŒºåŸŸå®½é«˜
    """
    try:
        # è®¡ç®—åŒºåŸŸè¾¹ç•Œ
        region_left = region_center_x - region_width // 2
        region_top = region_center_y - region_height // 2
        region_right = region_center_x + region_width // 2
        region_bottom = region_center_y + region_height // 2
        
        print(f"æ‰«æåŒºåŸŸ: ({region_left}, {region_top}) åˆ° ({region_right}, {region_bottom})")
        
        # è·å–é¡¶å±‚çª—å£
        windows = findwindows.find_windows(active_only=True, enabled_only=True)
        if not windows:
            print("æ²¡æœ‰æ‰¾åˆ°æ´»åŠ¨çª—å£")
            return None
        
        top_window_handle = windows[0]
        
        # å°è¯•è¿æ¥çª—å£
        try:
            app = Application(backend="uia").connect(handle=top_window_handle)
            backend_used = "uia"
        except:
            app = Application(backend="win32").connect(handle=top_window_handle)
            backend_used = "win32"
        
        window = app.window(handle=top_window_handle)
        
        # æ–¹æ³•1: å¿«é€Ÿç­›é€‰ - åªè·å–å¯è§ä¸”å¯ç”¨çš„æ§ä»¶
        all_controls = window.descendants()
        
        region_controls = []
        
        for control in all_controls:
            try:
                # å¿«é€Ÿæ£€æŸ¥ï¼šå…ˆæ£€æŸ¥å¯è§æ€§å’Œå¯ç”¨çŠ¶æ€
                if not (control.is_visible() and control.is_enabled()):
                    continue
                
                # è·å–æ§ä»¶ä½ç½®
                rect = control.rectangle()
                center_x = (rect.left + rect.right) // 2
                center_y = (rect.top + rect.bottom) // 2
                
                # æ£€æŸ¥æ˜¯å¦åœ¨ç›®æ ‡åŒºåŸŸå†…
                if (region_left <= center_x <= region_right and 
                    region_top <= center_y <= region_bottom):
                    
                    control_info = {
                        'control': control,
                        'control_type': control.element_info.control_type,
                        'name': control.window_text(),
                        'rectangle': rect,
                        'center': (center_x, center_y),
                        'size': (rect.width(), rect.height())
                    }
                    
                    region_controls.append(control_info)
                    
            except Exception as e:
                continue
        
        return {
            'window_info': {
                'title': window.window_text(),
                'backend': backend_used,
                'handle': top_window_handle
            },
            'region_controls': region_controls,
            'region_bounds': (region_left, region_top, region_right, region_bottom)
        }
        
    except Exception as e:
        print(f"è·å–åŒºåŸŸæ§ä»¶æ—¶å‡ºé”™: {e}")
        return None

def print_region_controls(result):
    """æ‰“å°åŒºåŸŸå†…æ§ä»¶ä¿¡æ¯"""
    if not result:
        print("æœªæ‰¾åˆ°ä»»ä½•æ§ä»¶")
        return
    
    print(f"\nçª—å£: {result['window_info']['title']}")
    print(f"åç«¯: {result['window_info']['backend']}")
    print(f"åœ¨æŒ‡å®šåŒºåŸŸå†…æ‰¾åˆ° {len(result['region_controls'])} ä¸ªæ§ä»¶:")
    
    for i, control in enumerate(result['region_controls']):
        print(f"\n{i+1}. {control['control_type']}: '{control['name']}'")
        print(f"   ä½ç½®: {control['rectangle']}")
        print(f"   ä¸­å¿ƒ: {control['center']}")
        print(f"   å°ºå¯¸: {control['size'][0]}x{control['size'][1]}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # ç¤ºä¾‹ï¼šæ‰«æå±å¹•ä¸­å¿ƒåŒºåŸŸ
    screen_center_x = 960  # æ ¹æ®ä½ çš„å±å¹•åˆ†è¾¨ç‡è°ƒæ•´
    screen_center_y = 540  # æ ¹æ®ä½ çš„å±å¹•åˆ†è¾¨ç‡è°ƒæ•´
    
    result = get_controls_in_region(screen_center_x, screen_center_y, 150, 150)
    print_region_controls(result)
```

## âš¡ æ›´é«˜æ•ˆçš„ç‰ˆæœ¬ - ä½¿ç”¨æ§ä»¶ç±»å‹è¿‡æ»¤

```python
def get_specific_controls_in_region(region_center_x, region_center_y, 
                                  region_width=150, region_height=150,
                                  target_types=None):
    """
    é«˜æ•ˆè·å–æŒ‡å®šåŒºåŸŸå†…ç‰¹å®šç±»å‹çš„æ§ä»¶
    target_types: ç›®æ ‡æ§ä»¶ç±»å‹åˆ—è¡¨ï¼Œå¦‚ ['Button', 'Edit', 'ComboBox']
    """
    if target_types is None:
        target_types = ['Button', 'Edit', 'ComboBox', 'CheckBox', 'RadioButton']
    
    # è®¡ç®—åŒºåŸŸè¾¹ç•Œï¼ˆåŒä¸Šï¼‰
    region_left = region_center_x - region_width // 2
    region_top = region_center_y - region_height // 2
    region_right = region_center_x + region_width // 2
    region_bottom = region_center_y + region_height // 2
    
    # è·å–çª—å£ï¼ˆåŒä¸Šï¼‰
    windows = findwindows.find_windows(active_only=True, enabled_only=True)
    if not windows:
        return None
    
    top_window_handle = windows[0]
    
    try:
        app = Application(backend="uia").connect(handle=top_window_handle)
    except:
        app = Application(backend="win32").connect(handle=top_window_handle)
    
    window = app.window(handle=top_window_handle)
    
    region_controls = []
    
    # åˆ†åˆ«æŸ¥è¯¢æ¯ç§ç›®æ ‡ç±»å‹ï¼Œé¿å…è·å–æ‰€æœ‰æ§ä»¶
    for control_type in target_types:
        try:
            controls = window.descendants(control_type=control_type)
            for control in controls:
                try:
                    if not (control.is_visible() and control.is_enabled()):
                        continue
                    
                    rect = control.rectangle()
                    center_x = (rect.left + rect.right) // 2
                    center_y = (rect.top + rect.bottom) // 2
                    
                    if (region_left <= center_x <= region_right and 
                        region_top <= center_y <= region_bottom):
                        
                        region_controls.append({
                            'control': control,
                            'control_type': control_type,
                            'name': control.window_text(),
                            'rectangle': rect,
                            'center': (center_x, center_y)
                        })
                        
                except:
                    continue
        except:
            continue
    
    return region_controls

# ä½¿ç”¨ç¤ºä¾‹
buttons_in_region = get_specific_controls_in_region(960, 540, 150, 150, ['Button'])
edits_in_region = get_specific_controls_in_region(960, 540, 150, 150, ['Edit'])
```

## ğŸª äº¤äº’å¼åŒºåŸŸé€‰æ‹©ç‰ˆæœ¬

```python
import pyautogui
import tkinter as tk
from threading import Thread

def select_region_interactively():
    """äº¤äº’å¼é€‰æ‹©åŒºåŸŸå¹¶è·å–æ§ä»¶ä¿¡æ¯"""
    
    def on_region_selected(x1, y1, x2, y2):
        """åŒºåŸŸé€‰æ‹©å®Œæˆåçš„å›è°ƒå‡½æ•°"""
        center_x = (x1 + x2) // 2
        center_y = (y1 + y2) // 2
        width = abs(x2 - x1)
        height = abs(y2 - y1)
        
        print(f"\nå·²é€‰æ‹©åŒºåŸŸ: ä¸­å¿ƒ({center_x}, {center_y}), å°ºå¯¸{width}x{height}")
        
        # è·å–è¯¥åŒºåŸŸå†…çš„æ§ä»¶
        result = get_controls_in_region(center_x, center_y, width, height)
        print_region_controls(result)
    
    # å¯åŠ¨åŒºåŸŸé€‰æ‹©å·¥å…·
    Thread(target=select_region_with_mouse, args=(on_region_selected,)).start()

def select_region_with_mouse(callback):
    """ä½¿ç”¨é¼ æ ‡é€‰æ‹©åŒºåŸŸ"""
    print("è¯·åœ¨å±å¹•ä¸Šæ‹–åŠ¨é¼ æ ‡é€‰æ‹©åŒºåŸŸ...")
    
    # è¿™é‡Œå¯ä»¥ä½¿ç”¨pyautoguiçš„æ‹–æ‹½åŠŸèƒ½
    # æˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„åŒºåŸŸé€‰æ‹©å·¥å…·
    
    # ç®€åŒ–ç‰ˆï¼šæ‰‹åŠ¨è¾“å…¥åæ ‡
    print("è¯·æ‰‹åŠ¨è¾“å…¥åŒºåŸŸåæ ‡:")
    x1 = int(input("å·¦ä¸Šè§’Xåæ ‡: "))
    y1 = int(input("å·¦ä¸Šè§’Yåæ ‡: "))
    x2 = int(input("å³ä¸‹è§’Xåæ ‡: "))
    y2 = int(input("å³ä¸‹è§’Yåæ ‡: "))
    
    callback(x1, y1, x2, y2)

# ä½¿ç”¨äº¤äº’å¼é€‰æ‹©
# select_region_interactively()
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–æŠ€å·§

1. **æå‰è¿‡æ»¤**ï¼šåœ¨è·å–æ§ä»¶æ—¶å°±æŒ‡å®šç±»å‹ï¼Œè€Œä¸æ˜¯è·å–æ‰€æœ‰å†è¿‡æ»¤
2. **å¿«é€Ÿæ£€æŸ¥**ï¼šå…ˆæ£€æŸ¥å¯è§æ€§å’Œå¯ç”¨çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„åæ ‡è®¡ç®—
3. **åˆ†æ‰¹å¤„ç†**ï¼šå¯¹äºå¤§çª—å£ï¼Œå¯ä»¥åˆ†æ‰¹è·å–ä¸åŒç±»å‹çš„æ§ä»¶
4. **ç¼“å­˜ç»“æœ**ï¼šå¦‚æœå¤šæ¬¡æŸ¥è¯¢ç›¸åŒåŒºåŸŸï¼Œå¯ä»¥ç¼“å­˜çª—å£è¿æ¥
